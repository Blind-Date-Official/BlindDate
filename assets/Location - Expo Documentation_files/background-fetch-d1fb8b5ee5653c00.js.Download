(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[56929],{15249:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/versions/v46.0.0/sdk/background-fetch",function(){return c(48320)}])},79475:function(c,a,b){"use strict";b.d(a,{Y:function(){return d},Z:function(){return e}});var d="https://snack.expo.dev";function e(a){var c=a.templateId,d=a.code,e=a.files,f=a.baseURL,b={};return e&&Object.keys(e).forEach(function(a){var c=e[a];/\.(jsx?|tsx?|json|md)$/i.test(a)?b[a]={type:"CODE",url:c.match(/^https?:\/\//)?c:"".concat(f,"/").concat(c)}:b[a]={type:"ASSET",contents:c}}),c?b["App.js"]={type:"CODE",url:"".concat(f,"/").concat(c,".js")}:d&&(b["App.js"]={type:"CODE",contents:d}),b}},28444:function(c,b,a){"use strict";a.d(b,{Z:function(){return g}});var d=a(26042),e=a(35944),f=a(4903);function g(a){var b=a.alt,c=a.src,g=a.style,h=a.containerStyle;return(0,e.tZ)("div",{style:(0,d.Z)({textAlign:"center",backgroundColor:f.theme.background.secondary,paddingTop:10,paddingBottom:10,marginTop:20,marginBottom:20},h),children:(0,e.tZ)("img",{src:c,alt:b,style:g})})}a(67294)},25374:function(f,d,a){"use strict";a.d(d,{F:function(){return o}});var g=a(26042),h=a(69396),i=a(35944),c=a(70917),b=a(4903);a(67294);var j=a(26084),k=a(18722),l=(0,c.iv)("line-height:1.8rem;margin-top:1.4rem;margin-bottom:1.4rem;color:",b.theme.text.default,";"),m=(0,c.iv)("font-family:",b.typography.fontFaces.medium,";font-weight:400;text-decoration:none;color:",b.theme.link.default,";:hover{text-decoration:underline;}"),n=(0,c.iv)("text-decoration:none;color:",b.theme.link.default,";:hover{text-decoration:underline;}"),e=function(a){var b,c=a.packageName,d=a.hideBareInstructions,e=a.cmd,h=void 0===e?["$ expo install ".concat(c)]:e,f=a.href,o=void 0===f?(b=c,"https://github.com/expo/expo/tree/main/packages/".concat(b.split(" ")[0])):f,g=(0,j.y)().sourceCodeUrl;return(0,i.BX)(i.HY,{children:[(0,i.tZ)(k.o,{cmd:h}),void 0!==d&&d?null:(0,i.BX)("p",{css:l,children:["If you're installing this in a"," ",(0,i.tZ)("a",{css:n,href:"/introduction/managed-vs-bare/#bare-workflow",children:"bare React Native app"}),", you should also follow"," ",(0,i.tZ)("a",{css:m,href:null!=g?g:o,children:"these additional installation instructions"}),"."]})]})};d.Z=e;var o=function(b){var a,c=(0,j.y)().packageName;return(0,i.tZ)(e,(0,h.Z)((0,g.Z)({},b),{packageName:null!==(a=b.packageName)&& void 0!==a?a:c}))}},67394:function(f,c,a){"use strict";a.d(c,{Z:function(){return b}});var g=a(51438),h=a(88029),i=a(29815),j=a(82337),k=a(35944),l=a(4903),d=a(67294),m=a(79475),e=a(72093),n=a(48192),o="v".concat(a(4147).i8),b=function(c){(0,h.Z)(a,c);var e=(0,j.Z)(a);function a(){var b;return(0,g.Z)(this,a),b=e.apply(this,arguments),b.contentRef=d.createRef(),b.state={ready:!1},b.getSelectedDocsVersion=function(){var a=b.context.version;return"latest"===a?o:a},b.getSnackSdkVersion=function(){var a=b.getSelectedDocsVersion();return"unversioned"===a&&(a=o),a.replace("v","")},b.getExamplesPath=function(){return"".concat(document.location.origin,"/static/examples/").concat(b.getSelectedDocsVersion())},b.getDependencies=function(){return(0,i.Z)(b.props.dependencies).join(",")},b.getCode=function(){return(b.contentRef.current&&b.contentRef.current.textContent||"").replace(/%%placeholder-start%%.*%%placeholder-end%%/g,"")},b}var b=a.prototype;return b.componentDidMount=function(){this.setState({ready:!0})},b.render=function(){return(0,k.BX)("div",{style:{marginBottom:l.spacing[4]},children:[(0,k.tZ)("div",{ref:this.contentRef,style:this.props.contentHidden?{display:"none"}:void 0,children:this.props.children}),(0,k.BX)("form",{action:m.Y,method:"POST",target:"_blank",children:[(0,k.tZ)("input",{type:"hidden",name:"platform",value:this.props.defaultPlatform||"android"}),(0,k.tZ)("input",{type:"hidden",name:"name",value:this.props.label||"Example"}),(0,k.tZ)("input",{type:"hidden",name:"dependencies",value:this.getDependencies()}),(0,k.tZ)("input",{type:"hidden",name:"sdkVersion",value:this.getSnackSdkVersion()}),this.props.platforms&&(0,k.tZ)("input",{type:"hidden",name:"supportedPlatforms",value:this.props.platforms.join(",")}),this.state.ready&&(0,k.tZ)("input",{type:"hidden",name:"files",value:JSON.stringify((0,m.Z)({templateId:this.props.templateId,code:this.getCode(),files:this.props.files,baseURL:this.getExamplesPath()}))}),(0,k.tZ)(n.z,{disabled:!this.state.ready,iconRight:(0,k.tZ)(l.ArrowUpRightIcon,{color:l.theme.palette.white}),type:"submit",children:this.props.buttonTitle||"Try this example on Snack"})]})]})},a}(d.Component);b.contextType=e.m$,b.defaultProps={dependencies:[]}},18722:function(e,d,c){"use strict";c.d(d,{o:function(){return A}});var f=c(35944),b=c(70917),a=c(4903),g=c(67294),h=function(a){var d=a.children,e=a.style,c=a.includeMargin;return(0,f.tZ)("div",{css:[i,(void 0===c||c)&&j,(0,b.iv)(e)],children:d})},i=(0,b.iv)({display:"flex",flexDirection:"column"}),j=(0,b.iv)({marginBottom:a.spacing[4]}),k=function(a){var d=a.children,b=a.alwaysDark,c=a.hideOverflow;return(0,f.tZ)("div",{css:[l,void 0!==b&&b&&m,void 0!==c&&c&&n],children:d})},l=(0,b.iv)("background-color:",a.theme.palette.black,";border:1px solid ",a.theme.border.default,";border-bottom-left-radius:",a.borderRadius.medium,"px;border-bottom-right-radius:",a.borderRadius.medium,"px;padding:",a.spacing[4],"px;overflow-x:auto;code{padding-left:0;padding-right:0;}"),m=(0,b.iv)("border-color:transparent;white-space:nowrap;"),n=(0,b.iv)("overflow:hidden;code{white-space:nowrap;}"),o=c(69036),p=function(b){var g=b.title,c=b.children,d=b.alwaysDark,e=void 0!==d&&d;return(0,f.BX)("div",{css:[q,e&&r],children:[(0,f.tZ)(o.GP,{css:[s,e&&{color:a.darkTheme.text.default}],children:g}),!!c&&(0,f.tZ)("div",{css:t,children:c})]})},q=(0,b.iv)("background-color:",a.theme.background.default,";border:1px solid ",a.theme.border.default,";border-bottom:none;border-top-left-radius:",a.borderRadius.medium,"px;border-top-right-radius:",a.borderRadius.medium,"px;display:flex;padding:0 8px 0 16px;justify-content:space-between;min-height:42px;"),r=(0,b.iv)("background-color:",a.darkTheme.background.tertiary,";border-color:transparent;"),s=(0,b.iv)("line-height:42px !important;user-select:none;"),t=(0,b.iv)("display:flex;justify-content:flex-end;align-items:center;"),u=c(26042),v=c(69396),w=c(99534),x=c(48192),y=function(b){var h=b.children,c=b.icon,d=b.alwaysDark,e=void 0!==d&&d,i=(0,w.Z)(b,["children","icon","alwaysDark"]),j={color:e?a.darkTheme.text.default:void 0,size:a.iconSize.small},k=c&&g.cloneElement(c,j);return(0,f.tZ)(x.z,(0,v.Z)((0,u.Z)({size:"mini",theme:"transparent",icon:k},i),{children:(0,f.tZ)(o.u5,{css:e&&{color:a.darkTheme.text.default},children:h})}))},z=function(b){var h=b.text,e=(0,w.Z)(b,["text"]),c=(0,g.useState)(!1),d=c[0],i=c[1];return(0,f.tZ)(y,(0,v.Z)((0,u.Z)({icon:(0,f.tZ)(a.ClipboardIcon,{}),onClick:function(){var a;null===(a=navigator.clipboard)|| void 0===a||a.writeText(h),i(!0),setTimeout(function(){return i(!1)},1500)},disabled:d},e),{children:d?"Copied!":"Copy"}))},A=function(a){var b=a.cmd,e=a.cmdCopy,g=a.hideOverflow,c=a.includeMargin,d=a.title;return(0,f.BX)(h,{style:D,includeMargin:void 0===c||c,children:[(0,f.tZ)(p,{alwaysDark:!0,title:void 0===d?"Terminal":d,children:B({cmd:b,cmdCopy:e})}),(0,f.tZ)(k,{alwaysDark:!0,hideOverflow:g,children:b.map(C)})]})};function B(a){var c=a.cmd,d=a.cmdCopy,b=d||function(b){var a=b.filter(function(a){return!a.startsWith("#")&&""!==a});if(1===a.length)return a[0].startsWith("$")?a[0].slice(2):a[0]}(c);return b&&(0,f.tZ)(z,{alwaysDark:!0,text:b})}function C(b,d){var c="line-".concat(d);return""===b.trim()?(0,f.tZ)("br",{css:E},c):b.startsWith("#")?(0,f.tZ)(o.cO,{css:[F,E,{color:a.darkTheme.code.comment}],children:b},c):b.startsWith("$")?(0,f.BX)("div",{children:[(0,f.tZ)(o.cO,{css:[F,E,{display:"inline",color:a.darkTheme.text.secondary},],children:"\u2192\xa0"}),(0,f.tZ)(o.cO,{css:F,children:b.substring(1).trim()})]},c):(0,f.tZ)(o.cO,{css:[F,{display:"inherit"}],children:b},c)}var D=(0,b.iv)("li &{margin-top:",a.spacing[4],"px;display:flex;}"),E=(0,b.iv)("user-select:none;"),F=(0,b.iv)("display:inline-block;line-height:130%;background-color:transparent;border:none;color:",a.darkTheme.text.default,";")},48320:function(f,b,a){"use strict";a.r(b),a.d(b,{default:function(){return e},headings:function(){return d},meta:function(){return c}});var g=a(99534);a(67294);var h=a(3905),i=a(25374),j=a(41765),k=a(28045),l=a(67394),m=a(28444),c={title:"BackgroundFetch",sourceCodeUrl:"https://github.com/expo/expo/tree/sdk-46/packages/expo-background-fetch",packageName:"expo-background-fetch"},d=[{depth:2,type:"text",title:"Known issues"},{depth:2,type:"text",title:"Installation"},{depth:2,type:"text",title:"Usage"},{depth:2,type:"text",title:"Triggering background fetches"},{depth:2,type:"text",title:"Configuration"},{depth:2,type:"text",title:"API"}],n={meta:c,headings:d};function e(a){var b=a.components,c=(0,g.Z)(a,["components"]);return(0,h.kt)("wrapper",Object.assign({},n,c,{components:b,mdxType:"MDXLayout"}),(0,h.kt)("p",null,(0,h.kt)("strong",{parentName:"p"},(0,h.kt)("inlineCode",{parentName:"strong"},"expo-background-fetch"))," provides an API to perform ",(0,h.kt)("a",Object.assign({parentName:"p"},{href:"https://developer.apple.com/documentation/uikit/core_app/managing_your_app_s_life_cycle/preparing_your_app_to_run_in_the_background/updating_your_app_with_background_app_refresh"}),"background fetch")," tasks, allowing you to run specific code periodically in the background to update your app. This module uses ",(0,h.kt)("a",Object.assign({parentName:"p"},{href:"/versions/v46.0.0/sdk/task-manager/"}),"TaskManager")," Native API under the hood."),(0,h.kt)(k.Z,{android:!0,emulator:!0,ios:!0,simulator:!0,mdxType:"PlatformsSection"}),(0,h.kt)("h2",Object.assign({},{id:"known-issues"}),"Known issues"),(0,h.kt)("p",null,(0,h.kt)("strong",{parentName:"p"},"iOS only"),": BackgroundFetch only works when the app is backgrounded, not if the app was terminated or upon device reboot. ",(0,h.kt)("a",Object.assign({parentName:"p"},{href:"https://github.com/expo/expo/issues/3582"}),"Here is the relevant GitHub issue")),(0,h.kt)("h2",Object.assign({},{id:"installation"}),"Installation"),(0,h.kt)(i.F,{mdxType:"APIInstallSection"}),(0,h.kt)("h2",Object.assign({},{id:"usage"}),"Usage"),(0,h.kt)("p",null,"Below is an example that demonstrates how to use ",(0,h.kt)("inlineCode",{parentName:"p"},"expo-background-fetch"),"."),(0,h.kt)(l.Z,{label:"Background Fetch Usage",dependencies:["expo-background-fetch","expo-task-manager"],mdxType:"SnackInline"},(0,h.kt)("pre",null,(0,h.kt)("code",Object.assign({parentName:"pre"},{className:"language-tsx"}),"import React from 'react';\nimport { StyleSheet, Text, View, Button } from 'react-native';\nimport * as BackgroundFetch from 'expo-background-fetch';\nimport * as TaskManager from 'expo-task-manager';\n\nconst BACKGROUND_FETCH_TASK = 'background-fetch';\n\n// 1. Define the task by providing a name and the function that should be executed\n// Note: This needs to be called in the global scope (e.g outside of your React components)\nTaskManager.defineTask(BACKGROUND_FETCH_TASK, async () => {\n  const now = Date.now();\n\n  console.log(`Got background fetch call at date: ${new Date(now).toISOString()}`);\n\n  // Be sure to return the successful result type!\n  return BackgroundFetch.BackgroundFetchResult.NewData;\n});\n\n// 2. Register the task at some point in your app by providing the same name, and some configuration options for how the background fetch should behave\n// Note: This does NOT need to be in the global scope and CAN be used in your React components!\nasync function registerBackgroundFetchAsync() {\n  return BackgroundFetch.registerTaskAsync(BACKGROUND_FETCH_TASK, {\n    minimumInterval: 60 * 15, // 15 minutes\n    stopOnTerminate: false, // android only,\n    startOnBoot: true, // android only\n  });\n}\n\n// 3. (Optional) Unregister tasks by specifying the task name\n// This will cancel any future background fetch calls that match the given name\n// Note: This does NOT need to be in the global scope and CAN be used in your React components!\nasync function unregisterBackgroundFetchAsync() {\n  return BackgroundFetch.unregisterTaskAsync(BACKGROUND_FETCH_TASK);\n}\n\nexport default function BackgroundFetchScreen() {\n  const [isRegistered, setIsRegistered] = React.useState(false);\n  const [status, setStatus] = React.useState(null);\n\n  React.useEffect(() => {\n    checkStatusAsync();\n  }, []);\n\n  const checkStatusAsync = async () => {\n    const status = await BackgroundFetch.getStatusAsync();\n    const isRegistered = await TaskManager.isTaskRegisteredAsync(BACKGROUND_FETCH_TASK);\n    setStatus(status);\n    setIsRegistered(isRegistered);\n  };\n\n  const toggleFetchTask = async () => {\n    if (isRegistered) {\n      await unregisterBackgroundFetchAsync();\n    } else {\n      await registerBackgroundFetchAsync();\n    }\n\n    checkStatusAsync();\n  };\n\n  return (\n    <View style={styles.screen}>\n      <View style={styles.textContainer}>\n        <Text>\n          Background fetch status:{' '}\n          <Text style={styles.boldText}>\n            {status && BackgroundFetch.BackgroundFetchStatus[status]}\n          </Text>\n        </Text>\n        <Text>\n          Background fetch task name:{' '}\n          <Text style={styles.boldText}>\n            {isRegistered ? BACKGROUND_FETCH_TASK : 'Not registered yet!'}\n          </Text>\n        </Text>\n      </View>\n      <View style={styles.textContainer}></View>\n      <Button\n        title={isRegistered ? 'Unregister BackgroundFetch task' : 'Register BackgroundFetch task'}\n        onPress={toggleFetchTask}\n      />\n    </View>\n  );\n}\n\n/* @hide */\nconst styles = StyleSheet.create({\n  screen: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n\n  textContainer: {\n    margin: 10,\n  },\n  boldText: {\n    fontWeight: 'bold',\n  },\n});\n\n/* @end */\n"))),(0,h.kt)("h2",Object.assign({},{id:"triggering-background-fetches"}),"Triggering background fetches"),(0,h.kt)("p",null,"Background fetches can be difficult to test because they can happen inconsistently. Fortunately, you can trigger background fetches manually when developing your apps."),(0,h.kt)("p",null,"For iOS, you can use the ",(0,h.kt)("inlineCode",{parentName:"p"},"Instruments")," app on macOS to manually trigger background fetches:"),(0,h.kt)("ol",null,(0,h.kt)("li",{parentName:"ol"},"Open the Instruments app. The Instruments app can be searched through Spotlight (\u2318 + Space) or opened from ",(0,h.kt)("inlineCode",{parentName:"li"},"/Applications/Xcode.app/Contents/Applications/Instruments.app")),(0,h.kt)("li",{parentName:"ol"},"Select ",(0,h.kt)("inlineCode",{parentName:"li"},"Time Profiler")),(0,h.kt)("li",{parentName:"ol"},"Select your device / simulator and pick the ",(0,h.kt)("inlineCode",{parentName:"li"},"Expo Go")," app"),(0,h.kt)("li",{parentName:"ol"},"Press the ",(0,h.kt)("inlineCode",{parentName:"li"},"Record")," button in the top left corner"),(0,h.kt)("li",{parentName:"ol"},"Navigate to the ",(0,h.kt)("inlineCode",{parentName:"li"},"Document")," Menu and select ",(0,h.kt)("inlineCode",{parentName:"li"},"Simulate Background Fetch - Expo Go"),":")),(0,h.kt)(m.Z,{alt:"Xcode Menu with Simulate Background Fetch option",src:"/static/images/simulate-background-fetch-instruments.png",mdxType:"ImageSpotlight"}),(0,h.kt)("p",null,"For Android, you can set the ",(0,h.kt)("inlineCode",{parentName:"p"},"minimumInterval")," option of your task to a small number and background your application like so:"),(0,h.kt)("pre",null,(0,h.kt)("code",Object.assign({parentName:"pre"},{className:"language-tsx"}),"async function registerBackgroundFetchAsync() {\n  return BackgroundFetch.registerTaskAsync(BACKGROUND_FETCH_TASK, {\n    minimumInterval: 1, // task will fire 1 minute after app is backgrounded\n  });\n}\n")),(0,h.kt)("h2",Object.assign({},{id:"configuration"}),"Configuration"),(0,h.kt)("p",null,"In order to use ",(0,h.kt)("inlineCode",{parentName:"p"},"BackgroundFetch")," API in standalone, detached and bare apps on iOS, your app has to include background mode in the ",(0,h.kt)("strong",{parentName:"p"},"Info.plist")," file. See ",(0,h.kt)("a",Object.assign({parentName:"p"},{href:"/versions/v46.0.0/sdk/task-manager/#configuration-for-standalone-apps"}),"background tasks configuration guide")," for more details."),(0,h.kt)("p",null,"On Android, this module might listen when the device is starting up. It's necessary to continue working on tasks started with ",(0,h.kt)("inlineCode",{parentName:"p"},"startOnBoot"),'. It also keeps devices "awake" that are going idle and asleep fast, to improve reliability of the tasks. Because of this both the ',(0,h.kt)("inlineCode",{parentName:"p"},"RECEIVE_BOOT_COMPLETED")," and ",(0,h.kt)("inlineCode",{parentName:"p"},"WAKE_LOCK")," permissions are added automatically."),(0,h.kt)("h2",Object.assign({},{id:"api"}),"API"),(0,h.kt)("pre",null,(0,h.kt)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"import * as BackgroundFetch from 'expo-background-fetch';\n")),(0,h.kt)(j.Z,{packageName:"expo-background-fetch",apiName:"BackgroundFetch",mdxType:"APISection"}))}e.isMDXComponent=!0}},function(a){a.O(0,[43611,49774,92888,40179],function(){var b;return a(a.s=15249)}),_N_E=a.O()}])