(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[51255],{18932:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/versions/v46.0.0/sdk/apple-authentication",function(){return c(66747)}])},25374:function(f,d,a){"use strict";a.d(d,{F:function(){return o}});var g=a(26042),h=a(69396),i=a(35944),c=a(70917),b=a(4903);a(67294);var j=a(26084),k=a(18722),l=(0,c.iv)("line-height:1.8rem;margin-top:1.4rem;margin-bottom:1.4rem;color:",b.theme.text.default,";"),m=(0,c.iv)("font-family:",b.typography.fontFaces.medium,";font-weight:400;text-decoration:none;color:",b.theme.link.default,";:hover{text-decoration:underline;}"),n=(0,c.iv)("text-decoration:none;color:",b.theme.link.default,";:hover{text-decoration:underline;}"),e=function(a){var b,c=a.packageName,d=a.hideBareInstructions,e=a.cmd,h=void 0===e?["$ expo install ".concat(c)]:e,f=a.href,o=void 0===f?(b=c,"https://github.com/expo/expo/tree/main/packages/".concat(b.split(" ")[0])):f,g=(0,j.y)().sourceCodeUrl;return(0,i.BX)(i.HY,{children:[(0,i.tZ)(k.o,{cmd:h}),void 0!==d&&d?null:(0,i.BX)("p",{css:l,children:["If you're installing this in a"," ",(0,i.tZ)("a",{css:n,href:"/introduction/managed-vs-bare/#bare-workflow",children:"bare React Native app"}),", you should also follow"," ",(0,i.tZ)("a",{css:m,href:null!=g?g:o,children:"these additional installation instructions"}),"."]})]})};d.Z=e;var o=function(b){var a,c=(0,j.y)().packageName;return(0,i.tZ)(e,(0,h.Z)((0,g.Z)({},b),{packageName:null!==(a=b.packageName)&& void 0!==a?a:c}))}},18722:function(e,d,c){"use strict";c.d(d,{o:function(){return A}});var f=c(35944),b=c(70917),a=c(4903),g=c(67294),h=function(a){var d=a.children,e=a.style,c=a.includeMargin;return(0,f.tZ)("div",{css:[i,(void 0===c||c)&&j,(0,b.iv)(e)],children:d})},i=(0,b.iv)({display:"flex",flexDirection:"column"}),j=(0,b.iv)({marginBottom:a.spacing[4]}),k=function(a){var d=a.children,b=a.alwaysDark,c=a.hideOverflow;return(0,f.tZ)("div",{css:[l,void 0!==b&&b&&m,void 0!==c&&c&&n],children:d})},l=(0,b.iv)("background-color:",a.theme.palette.black,";border:1px solid ",a.theme.border.default,";border-bottom-left-radius:",a.borderRadius.medium,"px;border-bottom-right-radius:",a.borderRadius.medium,"px;padding:",a.spacing[4],"px;overflow-x:auto;code{padding-left:0;padding-right:0;}"),m=(0,b.iv)("border-color:transparent;white-space:nowrap;"),n=(0,b.iv)("overflow:hidden;code{white-space:nowrap;}"),o=c(69036),p=function(b){var g=b.title,c=b.children,d=b.alwaysDark,e=void 0!==d&&d;return(0,f.BX)("div",{css:[q,e&&r],children:[(0,f.tZ)(o.GP,{css:[s,e&&{color:a.darkTheme.text.default}],children:g}),!!c&&(0,f.tZ)("div",{css:t,children:c})]})},q=(0,b.iv)("background-color:",a.theme.background.default,";border:1px solid ",a.theme.border.default,";border-bottom:none;border-top-left-radius:",a.borderRadius.medium,"px;border-top-right-radius:",a.borderRadius.medium,"px;display:flex;padding:0 8px 0 16px;justify-content:space-between;min-height:42px;"),r=(0,b.iv)("background-color:",a.darkTheme.background.tertiary,";border-color:transparent;"),s=(0,b.iv)("line-height:42px !important;user-select:none;"),t=(0,b.iv)("display:flex;justify-content:flex-end;align-items:center;"),u=c(26042),v=c(69396),w=c(99534),x=c(48192),y=function(b){var h=b.children,c=b.icon,d=b.alwaysDark,e=void 0!==d&&d,i=(0,w.Z)(b,["children","icon","alwaysDark"]),j={color:e?a.darkTheme.text.default:void 0,size:a.iconSize.small},k=c&&g.cloneElement(c,j);return(0,f.tZ)(x.z,(0,v.Z)((0,u.Z)({size:"mini",theme:"transparent",icon:k},i),{children:(0,f.tZ)(o.u5,{css:e&&{color:a.darkTheme.text.default},children:h})}))},z=function(b){var h=b.text,e=(0,w.Z)(b,["text"]),c=(0,g.useState)(!1),d=c[0],i=c[1];return(0,f.tZ)(y,(0,v.Z)((0,u.Z)({icon:(0,f.tZ)(a.ClipboardIcon,{}),onClick:function(){var a;null===(a=navigator.clipboard)|| void 0===a||a.writeText(h),i(!0),setTimeout(function(){return i(!1)},1500)},disabled:d},e),{children:d?"Copied!":"Copy"}))},A=function(a){var b=a.cmd,e=a.cmdCopy,g=a.hideOverflow,c=a.includeMargin,d=a.title;return(0,f.BX)(h,{style:D,includeMargin:void 0===c||c,children:[(0,f.tZ)(p,{alwaysDark:!0,title:void 0===d?"Terminal":d,children:B({cmd:b,cmdCopy:e})}),(0,f.tZ)(k,{alwaysDark:!0,hideOverflow:g,children:b.map(C)})]})};function B(a){var c=a.cmd,d=a.cmdCopy,b=d||function(b){var a=b.filter(function(a){return!a.startsWith("#")&&""!==a});if(1===a.length)return a[0].startsWith("$")?a[0].slice(2):a[0]}(c);return b&&(0,f.tZ)(z,{alwaysDark:!0,text:b})}function C(b,d){var c="line-".concat(d);return""===b.trim()?(0,f.tZ)("br",{css:E},c):b.startsWith("#")?(0,f.tZ)(o.cO,{css:[F,E,{color:a.darkTheme.code.comment}],children:b},c):b.startsWith("$")?(0,f.BX)("div",{children:[(0,f.tZ)(o.cO,{css:[F,E,{display:"inline",color:a.darkTheme.text.secondary},],children:"\u2192\xa0"}),(0,f.tZ)(o.cO,{css:F,children:b.substring(1).trim()})]},c):(0,f.tZ)(o.cO,{css:[F,{display:"inherit"}],children:b},c)}var D=(0,b.iv)("li &{margin-top:",a.spacing[4],"px;display:flex;}"),E=(0,b.iv)("user-select:none;"),F=(0,b.iv)("display:inline-block;line-height:130%;background-color:transparent;border:none;color:",a.darkTheme.text.default,";")},66747:function(f,b,a){"use strict";a.r(b),a.d(b,{default:function(){return e},headings:function(){return d},meta:function(){return c}});var g=a(99534);a(67294);var h=a(3905),i=a(41765),j=a(25374),k=a(28045),c={title:"AppleAuthentication",sourceCodeUrl:"https://github.com/expo/expo/tree/sdk-46/packages/expo-apple-authentication",packageName:"expo-apple-authentication"},d=[{depth:2,type:"text",title:"Installation"},{depth:2,type:"text",title:"Configuration"},{depth:3,type:"text",title:"EAS Build"},{depth:4,type:"text",title:"Managed Workflow"},{depth:4,type:"text",title:"Bare Workflow"},{depth:3,type:"text",title:"Classic Build"},{depth:2,type:"text",title:"Usage"},{depth:2,type:"text",title:"Development and Testing"},{depth:2,type:"text",title:"Verifying the Response from Apple"},{depth:2,type:"text",title:"API"},{depth:2,type:"text",title:"Error Codes"}],l={meta:c,headings:d};function e(a){var b=a.components,c=(0,g.Z)(a,["components"]);return(0,h.kt)("wrapper",Object.assign({},l,c,{components:b,mdxType:"MDXLayout"}),(0,h.kt)("p",null,(0,h.kt)("strong",{parentName:"p"},(0,h.kt)("inlineCode",{parentName:"strong"},"expo-apple-authentication"))," provides Apple authentication for iOS 13+. It does not yet support lower iOS versions, Android, or web."),(0,h.kt)("p",null,"Beginning with iOS 13, any app that includes third-party authentication options ",(0,h.kt)("strong",{parentName:"p"},"must")," provide Apple authentication as an option in order to comply with App Store Review guidelines. Learn more about Apple authentication on the ",(0,h.kt)("a",Object.assign({parentName:"p"},{href:"https://developer.apple.com/sign-in-with-apple/"}),'"Sign In with Apple" website'),"."),(0,h.kt)(k.Z,{ios:!0,simulator:!0,mdxType:"PlatformsSection"}),(0,h.kt)("h2",Object.assign({},{id:"installation"}),"Installation"),(0,h.kt)(j.F,{mdxType:"APIInstallSection"}),(0,h.kt)("h2",Object.assign({},{id:"configuration"}),"Configuration"),(0,h.kt)("h3",Object.assign({},{id:"eas-build"}),"EAS Build"),(0,h.kt)("p",null,"This guide assumes ",(0,h.kt)("a",Object.assign({parentName:"p"},{href:"/build-reference/ios-capabilities"}),"auto capability sync")," is enabled (Default). Otherwise you'll need to manually enable the capabilities for your bundle identifier through the Apple Developer Console."),(0,h.kt)("h4",Object.assign({},{id:"managed-workflow"}),"Managed Workflow"),(0,h.kt)("ol",null,(0,h.kt)("li",{parentName:"ol"},"Build with ",(0,h.kt)("inlineCode",{parentName:"li"},"eas build -p ios"),". EAS Build and the config plugin will automatically configure this service with Apple.")),(0,h.kt)("h4",Object.assign({},{id:"bare-workflow"}),"Bare Workflow"),(0,h.kt)("ol",null,(0,h.kt)("li",{parentName:"ol"},"Ensure you've added enabled the Apple Sign In capability, either through the Xcode:")),(0,h.kt)("ul",null,(0,h.kt)("li",{parentName:"ul"},"Signing & Capabilities > + Capability > Sign in with Apple"),(0,h.kt)("li",{parentName:"ul"},"Or by adding the entitlement to your ",(0,h.kt)("inlineCode",{parentName:"li"},"ios/[app]/[app].entitlements")," file",(0,h.kt)("pre",{parentName:"li"},(0,h.kt)("code",Object.assign({parentName:"pre"},{className:"language-xml"}),"<key>com.apple.developer.applesignin</key>\n<array>\n  <string>Default</string>\n</array>\n")))),(0,h.kt)("ol",Object.assign({},{start:2}),(0,h.kt)("li",{parentName:"ol"},"Add ",(0,h.kt)("inlineCode",{parentName:"li"},'"CFBundleAllowMixedLocalizations": true')," to your ",(0,h.kt)("inlineCode",{parentName:"li"},"ios/[app]/Info.plist")," to ensure the sign in button uses the device locale."),(0,h.kt)("li",{parentName:"ol"},"Build with ",(0,h.kt)("inlineCode",{parentName:"li"},"eas build -p ios"),". EAS Build will automatically configure this service with Apple.")),(0,h.kt)("h3",Object.assign({},{id:"classic-build"}),"Classic Build"),(0,h.kt)("ol",null,(0,h.kt)("li",{parentName:"ol"},"For managed projects, set ",(0,h.kt)("inlineCode",{parentName:"li"},"ios.usesAppleSignIn")," to ",(0,h.kt)("inlineCode",{parentName:"li"},"true")," in ",(0,h.kt)("inlineCode",{parentName:"li"},"app.json"),'. For bare, enable the "Sign In with Apple" capability in your app. For bare projects, enable the capability in Xcode under "Signing & Capabilities" -- you\'ll need to be on Xcode 11 or later.'),(0,h.kt)("li",{parentName:"ol"},'Log into the Apple Developer Console, go to "Certificates, Identifiers, & Profiles" and then "Identifiers".'),(0,h.kt)("li",{parentName:"ol"},"You need to choose a primary app for the Apple Sign In configuration. This is the app whose icon will show up in the Apple Sign In system UI. If you have a set of related apps you might choose the \"main\" app as the primary, but most likely you'll want to just use the app you're working on now as the primary."),(0,h.kt)("li",{parentName:"ol"},'In the list of identifiers, click on the one corresponding to your primary app. Enable the "Sign In with Apple" capability, click "Edit", and choose the "Enable as a primary App ID" option. Save the new configuration.'),(0,h.kt)("li",{parentName:"ol"},'If you chose a different app to be the primary, you\'ll also need to open up the configuration page for your current app, enable the "Sign In with Apple" capability, click "Edit" and choose the "Group with an existing primary App ID" option. Save this configuration as well.'),(0,h.kt)("li",{parentName:"ol"},'Next, go to the "Keys" page and register a new key. Add the "Sign In with Apple" capability, and make sure to choose the correct primary app on the configuration screen.'),(0,h.kt)("li",{parentName:"ol"},"Finally, when you want to make a standalone build to test with, run ",(0,h.kt)("inlineCode",{parentName:"li"},"expo build:ios --clear-provisioning-profile --revoke-credentials")," so that your provisioning profile is regenerated with the new entitlement."),(0,h.kt)("li",{parentName:"ol"},"(Optional) If you'd like to localize the button text, you can add ",(0,h.kt)("inlineCode",{parentName:"li"},'"CFBundleAllowMixedLocalizations": true')," to your ",(0,h.kt)("inlineCode",{parentName:"li"},"ios.infoPlist")," property ",(0,h.kt)("a",Object.assign({parentName:"li"},{href:"/../../../../../../../workflow/configuration/#ios"}),"in your app.json"),". Note: The localized value will only appear in your standalone app.")),(0,h.kt)("h2",Object.assign({},{id:"usage"}),"Usage"),(0,h.kt)("pre",null,(0,h.kt)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"import * as AppleAuthentication from 'expo-apple-authentication';\n\nfunction YourComponent() {\n  return (\n    <AppleAuthentication.AppleAuthenticationButton\n      buttonType={AppleAuthentication.AppleAuthenticationButtonType.SIGN_IN}\n      buttonStyle={AppleAuthentication.AppleAuthenticationButtonStyle.BLACK}\n      cornerRadius={5}\n      style={{ width: 200, height: 44 }}\n      onPress={async () => {\n        try {\n          const credential = await AppleAuthentication.signInAsync({\n            requestedScopes: [\n              AppleAuthentication.AppleAuthenticationScope.FULL_NAME,\n              AppleAuthentication.AppleAuthenticationScope.EMAIL,\n            ],\n          });\n          // signed in\n        } catch (e) {\n          if (e.code === 'ERR_CANCELED') {\n            // handle that the user canceled the sign-in flow\n          } else {\n            // handle other errors\n          }\n        }\n      }}\n    />\n  );\n}\n")),(0,h.kt)("h2",Object.assign({},{id:"development-and-testing"}),"Development and Testing"),(0,h.kt)("p",null,"You can test this library in development in Expo Go on iOS without following any of the instructions above; however, you'll need to do this setup in order to use Apple Authentication in your standalone app. When you sign into Expo Go, the identifiers and values you receive will likely be different than what you'll receive in standalone apps."),(0,h.kt)("p",null,"You can do limited testing of this library on the iOS simulator. However, not all methods will behave the same as on a device, so we highly recommend testing on a real device when possible while developing."),(0,h.kt)("h2",Object.assign({},{id:"verifying-the-response-from-apple"}),"Verifying the Response from Apple"),(0,h.kt)("p",null,"Apple's response includes a signed JWT with information about the user. To ensure that the response came from Apple, you can cryptographically verify the signature with Apple's public key, which is published at ",(0,h.kt)("a",Object.assign({parentName:"p"},{href:"https://appleid.apple.com/auth/keys"}),"https://appleid.apple.com/auth/keys"),". This process is not specific to Expo."),(0,h.kt)("h2",Object.assign({},{id:"api"}),"API"),(0,h.kt)("pre",null,(0,h.kt)("code",Object.assign({parentName:"pre"},{className:"language-js"}),"import * as AppleAuthentication from 'expo-apple-authentication';\n")),(0,h.kt)(i.Z,{packageName:"expo-apple-authentication",apiName:"AppleAuthentication",mdxType:"APISection"}),(0,h.kt)("h2",Object.assign({},{id:"error-codes"}),"Error Codes"),(0,h.kt)("table",null,(0,h.kt)("thead",{parentName:"table"},(0,h.kt)("tr",{parentName:"thead"},(0,h.kt)("th",Object.assign({parentName:"tr"},{align:null}),"Code"),(0,h.kt)("th",Object.assign({parentName:"tr"},{align:null}),"Description"))),(0,h.kt)("tbody",{parentName:"table"},(0,h.kt)("tr",{parentName:"tbody"},(0,h.kt)("td",Object.assign({parentName:"tr"},{align:null}),"ERR_APPLE_AUTHENTICATION_CREDENTIAL"),(0,h.kt)("td",Object.assign({parentName:"tr"},{align:null}),"The request to get credential state failed. See the error message for additional specific information.")),(0,h.kt)("tr",{parentName:"tbody"},(0,h.kt)("td",Object.assign({parentName:"tr"},{align:null}),"ERR_APPLE_AUTHENTICATION_INVALID_SCOPE"),(0,h.kt)("td",Object.assign({parentName:"tr"},{align:null}),"An invalid ",(0,h.kt)("a",Object.assign({parentName:"td"},{href:"/versions/v46.0.0/sdk/apple-authentication/#appleauthenticationappleauthenticationscope"}),(0,h.kt)("inlineCode",{parentName:"a"},"AppleAuthenticationScope"))," was passed in.")),(0,h.kt)("tr",{parentName:"tbody"},(0,h.kt)("td",Object.assign({parentName:"tr"},{align:null}),"ERR_APPLE_AUTHENTICATION_REQUEST_FAILED"),(0,h.kt)("td",Object.assign({parentName:"tr"},{align:null}),"The authentication request failed. See the error message for additional specific information.")),(0,h.kt)("tr",{parentName:"tbody"},(0,h.kt)("td",Object.assign({parentName:"tr"},{align:null}),"ERR_APPLE_AUTHENTICATION_UNAVAILABLE"),(0,h.kt)("td",Object.assign({parentName:"tr"},{align:null}),"Apple authentication is unavailable on the device.")),(0,h.kt)("tr",{parentName:"tbody"},(0,h.kt)("td",Object.assign({parentName:"tr"},{align:null}),"ERR_CANCELED"),(0,h.kt)("td",Object.assign({parentName:"tr"},{align:null}),"The user canceled the sign-in request from the system modal.")))))}e.isMDXComponent=!0}},function(a){a.O(0,[43611,49774,92888,40179],function(){var b;return a(a.s=18932)}),_N_E=a.O()}])